var c,q=new qtnIV,qt=q.identity(q.create()),attStride=null,mouseOn=!1,mx,my;function mouseDown(b){mouseOn=!0;mx=b.clientX;my=b.clientY}function mouseUp(b){mouseOn=!1}function mouseMove(b){if(mouseOn){var e=c.width,a=c.height,a=1/Math.sqrt(e*e+a*a),e=mx-b.clientX;b=my-b.clientY;var d=Math.sqrt(e*e+b*b),a=2*d*Math.PI*a;1!=d&&(d=1/d,e*=d/4,b*=d/4);q.rotate(a,[e,b,0],qt)}}
onload=function(){function b(b){var e=document.getElementById(b);if(e){switch(e.type){case "x-shader/x-vertex":b=a.createShader(a.VERTEX_SHADER);break;case "x-shader/x-fragment":b=a.createShader(a.FRAGMENT_SHADER);break;default:return}a.shaderSource(b,e.text);a.compileShader(b);if(a.getShaderParameter(b,a.COMPILE_STATUS))return b;alert(a.getShaderInfoLog(b))}}function e(b){var e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e);a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,
null);return e}c=document.getElementById("canvas");c.width=800;c.height=800;c.addEventListener("mousedown",mouseDown);c.addEventListener("mouseup",mouseUp);c.addEventListener("mousemove",mouseMove,!0);var a=c.getContext("webgl")||c.getContext("experimental-webgl");a.getParameter(a.ALIASED_POINT_SIZE_RANGE);var d=b("vs"),g=b("fs"),d=function(b,e){var d=a.createProgram();a.attachShader(d,b);a.attachShader(d,e);a.linkProgram(d);if(a.getProgramParameter(d,a.LINK_STATUS))return a.useProgram(d),d;alert(a.getProgramInfoLog(d))}(d,
g),k=[];k[0]=a.getAttribLocation(d,"position");k[1]=a.getAttribLocation(d,"color");attStride=[3,4];var m,n;e(m);e(n);var r=[];r[0]=a.getUniformLocation(d,"mvpMatrix");r[1]=a.getUniformLocation(d,"pointSize");var h=new matIV,p=h.identity(h.create()),l=h.identity(h.create()),u=h.identity(h.create()),x=h.identity(h.create()),t=h.identity(h.create());h.identity(h.create());a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);var y=0,z=0;(function(){m=[];n=[];a.clearColor(0,0,0,1);a.clearDepth(1);a.clear(a.COLOR_BUFFER_BIT|
a.DEPTH_BUFFER_BIT);var b=h.identity(h.create());q.toMatIV(qt,b);var d=2*Math.PI*y/800;800<=y++&&(y=0);var g=2*Math.PI*z/810;810<=z++&&(z=0);var v=30*Math.cos(d),d=30*Math.sin(d),g=12*Math.sin(g);h.lookAt([v,d,g],[0,0,0],[0,0,-1],l);h.multiply(l,b,l);h.perspective(45,c.width/c.height,.1,100,u);h.multiply(u,l,x);set_position(m,n);var b=e(m),v=e(n),b=[b,v],v=attStride,w;for(w in b)a.bindBuffer(a.ARRAY_BUFFER,b[w]),a.enableVertexAttribArray(k[w]),a.vertexAttribPointer(k[w],v[w],a.FLOAT,!1,0,0);h.identity(p);
h.rotate(p,Math.PI/2,[1,0,0],p);h.scale(p,[3,3,1],p);h.multiply(x,p,t);a.uniformMatrix4fv(r[0],!1,t);a.uniform1f(r[1],3);a.drawArrays(a.POINTS,0,m.length/3);a.flush();setTimeout(arguments.callee,1E3/30)})()};function color(){this.green=this.red=216;this.blue=48}color.prototype.create=function(b,e,a){this.red=b;this.green=e;this.blue=a};var colors=[];colors[0]=new color;colors[0].create(255,41,33);colors[1]=new color;colors[1].create(249,255,84);colors[2]=new color;colors[2].create(32,255,32);colors[3]=new color;colors[3].create(16,32,255);colors[4]=new color;colors[4].create(255,32,240);colors[4]=new color;colors[4].create(255,32,240);colors[5]=new color;colors[5].create(51,194,255);colors[6]=new color;
colors[6].create(255,194,51);colors[7]=new color;colors[7].create(207,207,207);function Cube(){this.px=[];this.py=[];this.pz=[];this.create=function(){for(var b=0,e=0;2>e;e++)for(var a=0;2>a;a++)for(var d=0;2>d;d++){var g=-1+2*a,k=-1+2*d;this.px[b]=(-1+2*e)/4;this.py[b]=g/4;this.pz[b]=k/1;b++}this.numStars=b}}
function Sphere(){this.px=[];this.py=[];this.pz=[];var b,e,a,d,g,k,m;this.create=function(n,r){var h=2*n-1,p=0,l,u,x=Math.PI;for(l=1;l<h;l++)p+=n*r*Math.sin(Math.PI*l/(h+1));l=1;for(p=0;l<=h;l++){e=Math.PI*l/(h+1);k=Math.cos(e);m=Math.sin(e);u=Math.floor(3*n*Math.sin(Math.PI*l/(h+1)));for(var t=0;t<u;t++)b=2*Math.PI*t/u,this.px[p]=r*m*Math.cos(b)*n,this.py[p]=r*m*Math.sin(b)*n,this.pz[p]=r*k*n,p++}a=Math.random()*Math.PI*2;e=Math.random()*Math.PI*2;d=Math.cos(a);g=Math.sin(a);k=Math.cos(e);m=Math.sin(e);
for(l=0;l<p;l++)h=this.px[l],u=this.py[l]*d-this.pz[l]*g,t=this.py[l]*g+this.pz[l]*d,this.px[l]=h*k-t*m,this.py[l]=u,this.pz[l]=(h*m+t*k)*x;this.numStars=p}}function shell(){this.g=this.r=255;this.b=128;this.time=0}
function shell(b,e,a,d,g,k,m,n){this.r=64;this.g=255;this.b=64;this.ox=b;this.oy=e;this.oz=a;this.start=k;this.end=m;this.life=n;this.time=k;this.gravity=8E-5;this.shooters=[];b=new Sphere;b.create(d,g);this.numShooter=b.numStars;this.position=[];this.color=[];this.sphere=new Sphere;this.sphere.create(d,g);this.num=this.sphere.numStars;this.time=0;this.active=!0}shell.prototype.setTime=function(b){this.time=b};shell.prototype.setColors=function(b,e,a){this.r=b;this.g=e;this.b=a};
shell.prototype.draw=function(b,e){if(!(this.time<this.start||this.time>this.end))for(var a=this.time-this.start,d=(this.end-this.time)/(.8*(this.end-this.start))/256,g=0;g<this.num;g++){b[pindex++]=this.ox+this.sphere.px[g]*a;b[pindex++]=this.oy+(this.sphere.py[g]+this.gravity*a)*a;b[pindex++]=this.oz+this.sphere.pz[g]*a;var k=this.r*d,m=this.g*d,n=this.b*d;e[cindex++]=k;e[cindex++]=m;e[cindex++]=n;e[cindex++]=1}};
shell.prototype.proceed=function(){this.time++;this.time>=this.life?(this.active=!1,this.time=0):this.active=!0;return this.active};shell.prototype.launcher=function(b,e,a,d,g,k,m,n,r){this.g=this.r=255;this.b=128;this.x=b;this.y=e;this.z=a;this.start=m;this.end=n;this.life=r;this.shooters=[];this.num=5;for(b=0;b<this.num;b++)this.sphere.px[b]=d*(.5+b/2/this.numShooter),this.sphere.py[b]=g*(.5+b/2/this.numShooter),this.sphere.pz[b]=k*(.5+b/2/this.numShooter);this.time=0;this.active=!0};
var pindex,cindex,num=12,theSet=[],life=240,diff=life/num,launcher_length=80,shell_length=160,launcher_start=0,shell_start=launcher_length-diff,rad=2,rnd=2,size=4,diff=60,vel=.007,gravity=4E-4,lx=0,ly=3,lz=0;function random_vector(){var b;b=Math.floor(6*Math.random())-3;var e=b/500;b=Math.floor(20*Math.random())-5;var a=-.08+b/400;b=Math.floor(6*Math.random())-3;b/=500;var d=Math.sqrt(e*e+a*a+b*b);return{x:e/d,y:a/d,z:b/d}}for(var i=0;i<num;i++){var f=new shell;f.time=20*-i;f.life=0;theSet[i]=f}
var lastx,lasty,lastz,level;
function set_position(b,e){cindex=pindex=0;for(var a=!1,d,g,k,m,n=0;n<num;n++)if(theSet[n].draw(b,e),a=theSet[n].proceed(),!a){if(0==n%2){level=Math.floor(3*Math.random())+2;k=.02*level;g=level;m=.005*level;a=0;d=a+launcher_length;g=new shell(lz,ly,lz,g,m,a,d,life);g.setColors(255,127,64);g.setTime=0;var r=random_vector();m=r.x*k;var h=r.y*k;k*=r.z;g.launcher(lastx,lasty,lastz,m,h,k,a,d,life);lastx=lx+m*launcher_length;lasty=ly+(h+g.gravity*launcher_length)*launcher_length;lastz=lz+k*launcher_length}else g=
level,a=40,d=a+shell_length,k=8E-4*level,g=new shell(lastx,lasty,lastz,g,k,a,d,life),a=Math.floor(8*Math.random()),a=colors[a],g.setColors(a.red,a.green,a.blue);theSet[n]=g}};
