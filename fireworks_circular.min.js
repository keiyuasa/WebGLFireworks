/*
 Use it if you like it
*/
function RGBColor(a){this.ok=!1;"#"==a.charAt(0)&&(a=a.substr(1,6));a=a.replace(/ /g,"");a=a.toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",
darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",
gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",
lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",
oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",
slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},d;for(d in e)a==d&&(a=e[d]);var b=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,
example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}];for(d=0;d<b.length;d++){var h=b[d].process,g=b[d].re.exec(a);g&&(channels=h(g),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=0>this.r||isNaN(this.r)?0:255<this.r?255:this.r;this.g=0>this.g||isNaN(this.g)?0:
255<this.g?255:this.g;this.b=0>this.b||isNaN(this.b)?0:255<this.b?255:this.b;this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var a=this.r.toString(16),b=this.g.toString(16),d=this.b.toString(16);1==a.length&&(a="0"+a);1==b.length&&(b="0"+b);1==d.length&&(d="0"+d);return"#"+a+b+d};this.getHelpXML=function(){for(var a=[],d=0;d<b.length;d++)for(var n=b[d].example,g=0;g<n.length;g++)a[a.length]=n[g];for(var m in e)a[a.length]=m;n=document.createElement("ul");
n.setAttribute("id","rgbcolor-examples");for(d=0;d<a.length;d++)try{var h=document.createElement("li"),t=new RGBColor(a[d]),y=document.createElement("div");y.style.cssText="margin: 3px; border: 1px solid black; background:"+t.toHex()+"; color:"+t.toHex();y.appendChild(document.createTextNode("test"));var A=document.createTextNode(" "+a[d]+" -> "+t.toRGB()+" -> "+t.toHex());h.appendChild(y);h.appendChild(A);n.appendChild(h)}catch(z){}return n}};var sequence0={author:"Kei Yuasa",created_date:"Dec 12, 2015",body:[{pause:160,spots:[{spot:0,color:"red",velocity:3}]},{pause:120,spots:[{spot:1,color:"gold"}]},{pause:100,spots:[{spot:2,color:"aliceblue"}]},{pause:80,spots:[{spot:3,color:"yellowgreen"}]},{pause:70,spots:[{spot:4,color:"beige"}]},{pause:60,spots:[{spot:5,color:"bisque"}]},{pause:50,spots:[{spot:6,color:"lightsalmon"}]},{pause:50,spots:[{spot:7,color:"lightcoral"}]},{pause:50,spots:[{spot:8,color:"mediumpurple"}]},{pause:50,spots:[{spot:9,
color:"turquoise"}]},{pause:50,spots:[{spot:10,color:"tomato"}]},{pause:50,spots:[{spot:11,color:"blue"}]},{pause:50,spots:[{spot:0,color:"red"}]},{pause:50,spots:[{spot:1,color:"gold"}]},{pause:50,spots:[{spot:2,color:"aliceblue"}]},{pause:50,spots:[{spot:3,color:"yellowgreen"}]},{pause:50,spots:[{spot:4,color:"beige"}]},{pause:50,spots:[{spot:5,color:"bisque"}]},{pause:50,spots:[{spot:6,color:"lightsalmon"}]},{pause:50,spots:[{spot:7,color:"lightcoral"}]},{pause:50,spots:[{spot:8,color:"mediumpurple"}]},
{pause:50,spots:[{spot:9,color:"turquoise"}]},{pause:50,spots:[{spot:10,color:"tomato"}]},{pause:50,spots:[{spot:11,color:"blue"}]},{pause:100,spots:[{spot:0,color:"red"},{spot:6,color:"gold"}]},{pause:40,spots:[{spot:1,color:"red"},{spot:7,color:"gold"}]},{pause:40,spots:[{spot:2,color:"red"},{spot:8,color:"gold"}]},{pause:40,spots:[{spot:3,color:"red"},{spot:9,color:"gold"}]},{pause:40,spots:[{spot:4,color:"red"},{spot:10,color:"gold"}]},{pause:40,spots:[{spot:5,color:"red"},{spot:11,color:"gold"}]},
{pause:40,spots:[{spot:6,color:"red"},{spot:0,color:"gold"}]},{pause:40,spots:[{spot:7,color:"red"},{spot:1,color:"gold"}]},{pause:40,spots:[{spot:8,color:"red"},{spot:2,color:"gold"}]},{pause:40,spots:[{spot:9,color:"red"},{spot:3,color:"gold"}]},{pause:40,spots:[{spot:10,color:"red"},{spot:4,color:"gold"}]},{pause:40,spots:[{spot:11,color:"red"},{spot:5,color:"gold"}]},{pause:180,spots:[{spot:0,color:"red"},{spot:4,color:"green"},{spot:8,color:"blue"}]},{pause:40,spots:[{spot:1,color:"red"},{spot:5,
color:"green"},{spot:9,color:"blue"}]},{pause:40,spots:[{spot:2,color:"red"},{spot:6,color:"green"},{spot:10,color:"blue"}]},{pause:40,spots:[{spot:3,color:"red"},{spot:7,color:"green"},{spot:11,color:"blue"}]},{pause:80,spots:[{spot:11,color:"#420202",velocity:5}]},{pause:20,spots:[{spot:10,color:"#421919",velocity:5}]},{pause:20,spots:[{spot:9,color:"#423030",velocity:5}]},{pause:20,spots:[{spot:8,color:"#424747",velocity:5}]},{pause:20,spots:[{spot:7,color:"#425e5e",velocity:5}]},{pause:20,spots:[{spot:6,
color:"#427575",velocity:5}]},{pause:20,spots:[{spot:5,color:"#428C8C",velocity:5}]},{pause:20,spots:[{spot:4,color:"#42A3A3",velocity:5}]},{pause:20,spots:[{spot:3,color:"#42baba",velocity:5}]},{pause:20,spots:[{spot:2,color:"#42d1d1",velocity:5}]},{pause:20,spots:[{spot:1,color:"#42e8e8",velocity:5}]},{pause:20,spots:[{spot:0,color:"#42ffff",velocity:5}]},{pause:160,spots:[{spot:0,color:"blue"},{spot:3,color:"red"},{spot:6,color:"yellow"},{spot:9,color:"green"}]},{pause:60,spots:[{spot:1,color:"blue"},
{spot:4,color:"red"},{spot:7,color:"yellow"},{spot:10,color:"green"}]},{pause:60,spots:[{spot:2,color:"blue"},{spot:5,color:"red"},{spot:8,color:"yellow"},{spot:11,color:"green"}]},{pause:40,spots:[{spot:3,color:"blue"},{spot:6,color:"red"},{spot:9,color:"yellow"},{spot:0,color:"green"}]},{pause:40,spots:[{spot:4,color:"blue"},{spot:7,color:"red"},{spot:10,color:"yellow"},{spot:1,color:"green"}]},{pause:40,spots:[{spot:5,color:"blue"},{spot:8,color:"red"},{spot:11,color:"yellow"},{spot:2,color:"green"}]},
{pause:30,spots:[{spot:6,color:"blue"},{spot:9,color:"red"},{spot:0,color:"yellow"},{spot:3,color:"green"}]},{pause:30,spots:[{spot:7,color:"blue"},{spot:10,color:"red"},{spot:1,color:"yellow"},{spot:4,color:"green"}]},{pause:30,spots:[{spot:8,color:"blue"},{spot:11,color:"red"},{spot:2,color:"yellow"},{spot:5,color:"green"}]},{pause:20,spots:[{spot:9,color:"blue"},{spot:0,color:"red"},{spot:3,color:"yellow"},{spot:6,color:"green"}]},{pause:20,spots:[{spot:10,color:"blue"},{spot:1,color:"red"},{spot:4,
color:"yellow"},{spot:7,color:"green"}]},{pause:20,spots:[{spot:11,color:"blue"},{spot:2,color:"red"},{spot:5,color:"yellow"},{spot:8,color:"green"}]},{pause:160,spots:[{spot:0,color:"blue"},{spot:2,color:"white"},{spot:4,color:"blue"},{spot:6,color:"white"},{spot:8,color:"blue"},{spot:10,color:"white"}]},{pause:80,spots:[{spot:1,color:"blue"},{spot:3,color:"white"},{spot:5,color:"blue"},{spot:7,color:"white"},{spot:9,color:"blue"},{spot:11,color:"white"}]},{pause:80,spots:[{spot:0,color:"blue"},
{spot:2,color:"white"},{spot:4,color:"blue"},{spot:6,color:"white"},{spot:8,color:"blue"},{spot:10,color:"white"}]},{pause:80,spots:[{spot:1,color:"blue"},{spot:3,color:"white"},{spot:5,color:"blue"},{spot:7,color:"white"},{spot:9,color:"blue"},{spot:11,color:"white"}]},{pause:140,spots:[{spot:0,color:"#ff0000",velocity:5}]},{pause:20,spots:[{spot:1,color:"#ff1a33",velocity:5}]},{pause:20,spots:[{spot:2,color:"#ff6000",velocity:5}]},{pause:20,spots:[{spot:3,color:"#ff9900",velocity:5}]},{pause:20,
spots:[{spot:4,color:"#ffff00",velocity:5}]},{pause:20,spots:[{spot:5,color:"#66ff00",velocity:5}]},{pause:20,spots:[{spot:6,color:"#00ff1a",velocity:5}]},{pause:20,spots:[{spot:7,color:"#00ff99",velocity:5}]},{pause:20,spots:[{spot:8,color:"#0066ff",velocity:5}]},{pause:20,spots:[{spot:9,color:"#001aff",velocity:5}]},{pause:20,spots:[{spot:10,color:"#3300ff",velocity:5}]},{pause:20,spots:[{spot:11,color:"#9900ff",velocity:5}]},{pause:120,spots:[{spot:0,color:"#ff0000",velocity:7},{spot:1,color:"#ff1a33",
velocity:7},{spot:2,color:"#ff6000",velocity:7},{spot:3,color:"#ff9900",velocity:7},{spot:4,color:"#ffff00",velocity:7},{spot:5,color:"#66ff00",velocity:7},{spot:6,color:"#00ff1a",velocity:7},{spot:7,color:"#00ff99",velocity:7},{spot:8,color:"#0066ff",velocity:7},{spot:9,color:"#001aff",velocity:7},{spot:10,color:"#3300ff",velocity:7},{spot:11,color:"#9900ff",velocity:7}]},{pause:120,spots:[{spot:6,color:"#ff0000",velocity:8},{spot:7,color:"#ff1a33",velocity:8},{spot:8,color:"#ff6000",velocity:8},
{spot:9,color:"#ff9900",velocity:8},{spot:10,color:"#ffff00",velocity:8},{spot:11,color:"#66ff00",velocity:8},{spot:0,color:"#00ff1a",velocity:8},{spot:1,color:"#00ff99",velocity:8},{spot:2,color:"#0066ff",velocity:8},{spot:3,color:"#001aff",velocity:8},{spot:4,color:"#3300ff",velocity:8},{spot:5,color:"#9900ff",velocity:8}]}]};function groundPattern(a,e,d,b,h){this.cycle=65536;this.time=0;this.num_points=a;this.radius=e;this.px=d;this.py=b;this.pz=h}
groundPattern.prototype.render=function(a,e,d,b,h){var g=0,p=[],k=[],n=[],r=[],m=[],x=10*this.num_points;alfa=.75;for(g=0;g<x+1;g++){var t=this.time*Math.PI*2/2048,y=.2*(Math.sin(2*t)+1),A=.2*(Math.sin(3*t)+1),z=.2*(Math.sin(5*t)+1),u=radius-1,v=radius+1;0==g%10&&(u=radius-3);var t=2*Math.PI*g/x,w=Math.cos(t),B=Math.sin(t),t=u*w,u=u*B;p.push(t);p.push(.05);p.push(u);m.push(y);m.push(A);m.push(z);m.push(alfa);w*=v;v*=B;p.push(w);p.push(.05);p.push(v);m.push(y);m.push(A);m.push(z);m.push(alfa);k.push(w);
k.push(1.75);k.push(v);k.push(t);k.push(1.75);k.push(u);n.push(t);n.push(1.75);n.push(u);n.push(t);n.push(.05);n.push(u);r.push(w);r.push(.05);r.push(v);r.push(w);r.push(1.75);r.push(v)}g=d(p);m=d(m);e([g,m],loc_ground,stride_ground);a.uniformMatrix4fv(b[0],!1,h);a.uniform1f(b[1],3);a.drawArrays(a.TRIANGLE_STRIP,0,p.length/3);a.flush();g=d(k);e([g,m],loc_ground,stride_ground);a.uniformMatrix4fv(b[0],!1,h);a.uniform1f(b[1],3);a.drawArrays(a.TRIANGLE_STRIP,0,k.length/3);a.flush();g=d(n);e([g,m],loc_ground,
stride_ground);a.uniformMatrix4fv(b[0],!1,h);a.uniform1f(b[1],3);a.drawArrays(a.TRIANGLE_STRIP,0,n.length/3);a.flush();g=d(r);e([g,m],loc_ground,stride_ground);a.uniformMatrix4fv(b[0],!1,h);a.uniform1f(b[1],3);a.drawArrays(a.TRIANGLE_STRIP,0,r.length/3);a.flush();this.time++;this.time>=this.cycle&&(this.time=0)};var groundx=4,groundy=4.8,groundz=8,alfa=.9,texture_image=null,DrawingMethod=null,pindex_ground=0,cindex_ground=0,pattern=1,patternLoop=2,ring_r=.5,ring_g=.5,ring_b=1,graphicLib=null,textureImage=null,texture,img=null,count=0,uniLocation=[],theGroundEffects;function groundEffect(){}function groundEffect(a,e,d,b,h,g){this.start=a;this.end=e;this.life=d;this.ox=b;this.oy=h;this.oz=g;this.time=0;this.active=!0}groundEffect.prototype.setColors=function(a,e,d){this.red=a;this.green=e;this.blue=d};
groundEffect.prototype.draw=function(a,e,d){if(this.time<=this.start||this.time>this.end)return d;for(var b=this.end-this.start,h=this.end-this.time,g=.3*h,p=.1*h,k=3*d,n=4*d,r=0;32>=r;r++){var m=2*Math.PI*r/32,x=Math.sin(m),t=Math.cos(m),m=this.ox+g*x,y=this.oy,A=this.oz+g*t,x=this.ox+p*x,z=this.oy,t=this.oz+p*t,u=this.red*(b-h)/b;0>u&&(u=0);var v=this.green*(b-h)/b;0>v&&(v=0);var w=this.blue*(b-h)/b;0>w&&(w=0);alfa=1;a[k++]=m;a[k++]=y;a[k++]=A;e[n++]=u;e[n++]=v;e[n++]=w;e[n++]=alfa;d++;a[k++]=x;
a[k++]=z;a[k++]=t;e[n++]=u;e[n++]=v;e[n++]=w;e[n++]=alfa;d++}return d};groundEffect.prototype.proceed=function(){this.time++;return this.active=this.time>=this.life?!1:!0};function init_ground(){cindex_ground=pindex_ground=0;pattern=1;patternLoop=2;ring_g=ring_r=.5;ring_b=1;img=textureImage=graphicLib=null;count=0;uniLocation=[];theGroundEffects=[]}function genEffect(a){return new groundEffect(0+35*a,10+35*a,24+35*a,lx[a],ly[a],lz[a])}
function render_ground(a,e,d){cindex_ground=pindex_ground=0;var b=theGroundEffects[d];b.draw(a,e);b.proceed()||(theGroundEffects[d]=genEffect(d));DrawingMethod=1}function set_position_ground(a,e,d){};function color(){this.green=this.red=216;this.blue=48}color.prototype.create=function(a,e,d){this.red=a;this.green=e;this.blue=d};var colors=[];colors[0]=new color;colors[0].create(255,41,33);colors[1]=new color;colors[1].create(249,255,84);colors[2]=new color;colors[2].create(32,255,32);colors[3]=new color;colors[3].create(16,32,255);colors[4]=new color;colors[4].create(255,32,240);colors[4]=new color;colors[4].create(255,32,240);colors[5]=new color;colors[5].create(51,194,255);colors[6]=new color;
colors[6].create(255,194,51);colors[7]=new color;colors[7].create(207,207,207);function Sphere(){this.px=[];this.py=[];this.pz=[];var a,e,d;this.create=function(b,h){this.px=[];this.py=[];this.pz=[];var g=2*b+1,p=4*b,k=0,n;for(n=0;n<g;n++){var r=Math.floor(Math.sin(Math.PI*n/(g-1))*p);0==r&&(r=1);k+=r}for(n=k=0;n<g;n++)if(r=Math.PI*n/(g-1),e=Math.cos(r),d=Math.sin(r),l=Math.floor(d*p),l=Math.floor(Math.sin(Math.PI*n/(g-1))*p),0==l)this.px[k]=0,this.py[k]=0,this.pz[k]=h*e,k++;else for(j=0;j<l;j++)a=2*Math.PI*j/l,this.px[k]=h*d*Math.cos(a),this.py[k]=h*d*Math.sin(a),this.pz[k]=
h*e,k++;this.numStars=k}};var q=new qtnIV,qt=q.identity(q.create()),loc_fireworks=null,stride_fireworks=null,loc_ground=null,stride_ground=null,ground=null,mouseOn=!1,mx,my,prg_fireworks=null,pointSize=3,time_shift=12,time=0,timeLoop=240,lx=[],ly=[],lz=[],radius=24,px=0,py=0,pz=-100,pi1=0,pi2=4,pi3=8,f=-40,distance=75,scale=.5,cycle=120,num_points=12;function mouseDown(a){mouseOn=!0;mx=a.clientX;my=a.clientY}function mouseUp(a){mouseOn=!1}
function mouseMove(a){if(mouseOn){var e=c.width,d=c.height,d=1/Math.sqrt(e*e+d*d),e=mx-a.clientX;a=my-a.clientY;var b=Math.sqrt(e*e+a*a),d=2*b*Math.PI*d;1!=b&&(b=1/b,e*=b/4,a*=b/4);q.rotate(d,[e,a,0],qt)}}init_ground();
onload=function(){function a(a){var d=document.getElementById(a);if(d){switch(d.type){case "x-shader/x-vertex":a=b.createShader(b.VERTEX_SHADER);break;case "x-shader/x-fragment":a=b.createShader(b.FRAGMENT_SHADER);break;default:return}b.shaderSource(a,d.text);b.compileShader(a);if(b.getShaderParameter(a,b.COMPILE_STATUS))return a;alert(b.getShaderInfoLog(a))}}function e(a){var d=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,d);b.bufferData(b.ARRAY_BUFFER,new Float32Array(a),b.STATIC_DRAW);b.bindBuffer(b.ARRAY_BUFFER,
null);return d}function d(a,d,e){for(var g in a)b.bindBuffer(b.ARRAY_BUFFER,a[g]),b.enableVertexAttribArray(d[g]),b.vertexAttribPointer(d[g],e[g],b.FLOAT,!1,0,0)}c=document.getElementById("night_sky");c.width=800;c.height=800;c.addEventListener("mousedown",mouseDown);c.addEventListener("mouseup",mouseUp);c.addEventListener("mousemove",mouseMove,!0);var b=c.getContext("webgl")||c.getContext("experimental-webgl");b.getParameter(b.ALIASED_POINT_SIZE_RANGE);var h=a("vs"),g=a("fs");prg_fireworks=function(a,
d){var e=b.createProgram();b.attachShader(e,a);b.attachShader(e,d);b.linkProgram(e);if(b.getProgramParameter(e,b.LINK_STATUS))return b.useProgram(e),e;alert(b.getProgramInfoLog(e))}(h,g);loc_fireworks=[];loc_fireworks[0]=b.getAttribLocation(prg_fireworks,"position");loc_fireworks[1]=b.getAttribLocation(prg_fireworks,"color");loc_ground=[];loc_ground[0]=b.getAttribLocation(prg_fireworks,"position");loc_ground[1]=b.getAttribLocation(prg_fireworks,"color");stride_fireworks=[3,4];stride_ground=[3,4];
var p=[],k=[],n=[];n[0]=b.getUniformLocation(prg_fireworks,"mvpMatrix");n[1]=b.getUniformLocation(prg_fireworks,"pointSize");var r=[];r[0]=b.getUniformLocation(prg_fireworks,"mvpMatrix");r[1]=b.getUniformLocation(prg_fireworks,"pointSize");var m=new matIV,x=m.identity(m.create()),t=m.identity(m.create()),y=m.identity(m.create()),A=m.identity(m.create()),z=m.identity(m.create());m.identity(m.create());b.enable(b.DEPTH_TEST);b.depthFunc(b.LEQUAL);var u=0,v=0,w=0;new firework;radius=24;fws=new fireworks;
num_points=12;fws.setup_fireworks(num_points,radius,px,py,pz);var B=sequence0.body,H=B.length,E=0,D=B[E],G=D.pause,F=D.spots;ground=new groundPattern(num_points,radius,px,py,pz);(function(){position=[];color=[];p=[];k=[];b.clearColor(0,0,0,1);b.clearDepth(1);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);var a=m.identity(m.create());q.toMatIV(qt,a);var g=2*Math.PI*u/2E3;2E3<=(u+=.7)&&(u=0);var h=2*Math.PI*v/2020;2020<=(v+=.8)&&(v=0);var C=distance*Math.cos(g)*Math.cos(h),g=distance*Math.sin(g)*Math.cos(h);
m.lookAt([C,g,f],[px,py,pz],[0,0,-1],t);m.identity(x);m.rotate(x,Math.PI/2,[1,0,0],x);m.scale(x,[scale,scale,scale],x);m.multiply(A,x,z);m.multiply(t,a,t);m.perspective(45,c.width/c.height,.1,100,y);m.multiply(y,t,A);fws.proceed();e(p);e(k);ground.render(b,d,e,r,z);for(i=0;i<num_points;i++)p=[],k=[],num=fws.render_triangle_strip(p,k,i),0<num&&(C=e(p),g=e(k),d([C,g],loc_ground,stride_ground),length=p.length,b.uniformMatrix4fv(r[0],!1,z),b.uniform1f(r[1],3),b.drawArrays(b.TRIANGLE_STRIP,0,p.length/
3),b.flush());num=fws.render_points(position,color,0);0<num&&(C=e(position),g=e(color),d([C,g],loc_fireworks,stride_fireworks),length=position.length,b.uniformMatrix4fv(n[0],!1,z),b.uniform1f(n[1],3),b.drawArrays(b.POINTS,0,position.length/3),b.flush());w++;if(w==G){a=F.length;for(i=0;i<a;i++)fws.generate(F[i]);++E>=H&&(E=0);D=B[E];G=D.pause;F=D.spots;w=0}p=[];k=[];setTimeout(arguments.callee,20)})()};function shell(){this.g=this.r=255;this.b=128;this.time=0}function shell(a,e,d,b,h,g,p,k){this.r=64;this.g=255;this.b=64;this.ox=a;this.oy=e;this.oz=d;this.start=g;this.end=p;this.life=k;this.time=g;this.gravity=8E-5;this.shooters=[];a=new Sphere;a.create(b,h);this.numShooter=a.numStars;this.position=[];this.color=[];this.sphere=new Sphere;this.sphere.create(b,h);this.num=this.sphere.numStars;this.time=0;this.active=!0}shell.prototype.setTime=function(a){this.time=a};
shell.prototype.setColors=function(a,e,d){this.r=a;this.g=e;this.b=d};shell.prototype.draw=function(a,e,d){if(this.time<this.start||this.time>this.end)return d;for(var b=this.time-this.start,h=(this.end-this.time)/(.8*(this.end-this.start)),g=3*d,p=4*d,k=0;k<this.num;k++){a[g++]=this.ox+this.sphere.px[k]*b;a[g++]=this.oy+this.sphere.py[k]*b;a[g++]=this.oz+this.sphere.pz[k]*b;var n=this.r*h,r=this.g*h,m=this.b*h;e[p++]=n;e[p++]=r;e[p++]=m;e[p++]=1;d++}return d};
shell.prototype.proceed=function(){this.time++;this.time>=this.life?(this.active=!1,this.time=0):this.active=!0;return this.active};function random_vector(){var a;a=Math.floor(6*Math.random())-3;var e=a/500;a=Math.floor(20*Math.random())-5;var d=-.08+a/400;a=Math.floor(6*Math.random())-3;a/=500;var b=Math.sqrt(e*e+d*d+a*a);return{x:e/b,y:d/b,z:a/b}}
function set_position(a,e){cindex=pindex=0;lindex=Math.floor(time/time_shift);for(var d=0;d<2*num_points;d++){var b=theSet[d];null!=b&&(b.draw(a,e),b.proceed())}}function FireworksSet(a,e){this.numFireworks=a;this.halfTime=e/2;this.half=a/2;this.set1=[];this.set2=[];this.life=e;for(i=0;i<this.half;i++)this.set1[i]=null,this.set2[i]=null}FireworksSet.prototype.numFireworks=function(){return this.numFireworks};
FireworksSet.prototype.render=function(a,e){for(i=cindex=pindex=0;i<this.set1.length;i++)f=this.set1[i],null!=f&&(f.draw(a,e),f.proceed()||(this.set1[i]=null));for(i=0;i<this.set2.length;i++)f=this.set2[i],null!=f&&(f.draw(a,e),f.proceed()||(this.set2[i]=null))};
FireworksSet.prototype.addFireworks=function(a,e){var d=null;e<this.halfTime?(d=this.set1,console.log("create in set1")):(d=this.set2,console.log("create in set2"));for(i=0;i<d.length;i++)if(null==d[i]){lindex=a;level[lindex]=Math.floor(3*Math.random())+2;vlen=.02*level[lindex];lsize=level[lindex];vel=.01*lsize;start=e;end=start+launcher_length;var b=random_vector(),h=b.x*vlen,g=b.y*vlen,b=b.z*vlen;f=new shell(lx[lindex],ly[lindex],lz[lindex],lsize,vel,start,end,life);f.launcher(lx[lindex],ly[lindex],
lz[lindex],h,g,b,start,end,life);f.setColors(175,175,64);f.setTime=0;d[i]=f;console.log("created shell at "+i+", lindex="+lindex+", x="+lx[lindex]+", y="+ly[lindex]+", z="+lz[lindex]);break}};function launcher(a,e,d,b,h,g,p,k,n){this.g=this.r=255;this.b=128;this.ox=a;this.oy=e;this.oz=d;this.start=p;this.end=k;this.life=n;this.shooters=[];level=Math.floor(3*Math.random())+2;level=1;vel=.01;this.sphere=new Sphere;this.sphere.create(level,vel);this.num=this.sphere.numStars;this.gravity=h/(p-n);a=Math.floor(Math.random()*this.sphere.numStars);this.vx=b+this.sphere.px[a];this.vy=h+this.sphere.py[a];this.vz=g+this.sphere.pz[a];this.time=0;this.active=!0;b=this.end-this.start;this.endx=this.ox+
this.vx*b;this.endy=this.oy+(this.vy+this.gravity*b)*b;this.endz=this.oz+this.vz*b}launcher.prototype.setColors=function(a,e,d){this.r=a;this.g=e;this.b=d};launcher.prototype.proceed=function(){this.time++;this.time>=this.life?(this.active=!1,this.time=0):this.active=!0;return this.active};
launcher.prototype.draw=function(a,e,d){if(this.time<this.start||this.time>this.end)return d;for(var b=this.time-this.start,h=(this.end-this.time)/(this.end-this.start)/256,g=3*d,p=4*d,k=0;k<this.num;k++){a[g++]=this.ox+this.vx*b;a[g++]=this.oy+(this.vy+this.gravity*b)*b;a[g++]=this.oz+this.vz*b;var n=this.r*h,r=this.g*h,m=this.b*h;e[p++]=n;e[p++]=r;e[p++]=m;e[p++]=1;d++}return d};this.num_points=0;this.lz=this.ly=this.lx=null;var pz=py=px=radius=0,svel=3;function fireworks(){this.arr=[]}fireworks.prototype.setup_fireworks=function(a,e,d,b,h){this.num_points=a;this.radius=e;px=d;py=b;pz=h;this.lx=[];this.ly=[];this.lz=[];for(a=0;a<this.num_points;a++)d=2*Math.PI*a/this.num_points,e=Math.cos(d),d=Math.sin(d),this.lx[a]=px+this.radius*e,this.ly[a]=py,this.lz[a]=pz+this.radius*d,this.arr[a]=null};
fireworks.prototype.generate=function(a){pi=a.spot;var e;e=null!=a.color?new RGBColor(a.color):new RGBColor("yellow");e.ok||(e=new RGBColor("yellow"));size=a.size;null==size&&(size=3);a=a.velocity;null==a&&(a=3);if(null==this.arr[pi]||!this.arr[pi].isActive()){var d=new firework;d.color=e;d.ssize=size;d.vel=a/10;d.create(this.lx[pi],this.ly[pi],this.lz[pi]);this.arr[pi]=d}};
fireworks.prototype.proceed=function(){for(var a=!0,e=0;e<this.num_points;e++){var d=this.arr[e],b=!0;null!=d&&(b=d.proceed(),a&=b)}return a};fireworks.prototype.render_triangle_strip=function(a,e,d){var b=0;null!=this.arr[i]&&(b=this.arr[d].render_triangle_strip(a,e,b));return b};fireworks.prototype.render_points=function(a,e,d){for(var b=0;b<this.num_points;b++)null!=this.arr[b]&&(d+=this.arr[b].render_points(a,e,d));return d};function firework(){this.shell=this.launcher=this.ground=null}
var life=120;
firework.prototype.create=function(a,e,d){this.start=0;this.end=30;this.life=life;this.x=a;this.y=e;this.z=d;this.lstart=0;this.lend=40;this.lvx=0;this.lvy=-.9;this.lvz=0;this.red=this.color.r/256;this.green=this.color.g/256;this.blue=this.color.b/256;this.ground=new groundEffect(this.start,this.end,this.life,this.x,this.y,this.z);this.ground.setColors(this.red,this.green,this.blue);this.launcher=new launcher(this.x,this.y,this.z,this.lvx,this.lvy,this.lvz,this.lstart,this.lend,this.life);this.sx=
this.launcher.endx;this.sy=this.launcher.endy;this.sz=this.launcher.endz;this.sstart=50;this.send=90;this.slife=life;this.shell=new shell(this.sx,this.sy,this.sz,this.ssize,this.vel,this.sstart,this.send,this.slife);this.shell.setColors(this.red,this.green,this.blue)};
firework.prototype.proceed=function(){var a=!1,e=!1,d=!1;null!=this.ground&&this.ground.active?this.ground.proceed():a=!0;null!=this.launcher&&this.launcher.active?this.launcher.proceed():e=!0;null!=this.shell&&this.shell.active?this.shell.proceed():d=!0;return a&&e&&d};firework.prototype.isActive=function(){return this.ground.active||this.launcher.active||this.shell.active};
firework.prototype.render_triangle_strip=function(a,e,d){null!=this.ground&&this.ground.active&&(d=this.ground.draw(a,e,d));return d};firework.prototype.render_points=function(a,e,d){null!=this.launcher&&this.launcher.active&&(d=this.launcher.draw(a,e,d));null!=this.shell&&this.shell.active&&(d=this.shell.draw(a,e,d));return d};
